<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Aca::Joiner
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Aca::Joiner";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (J)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Aca.html" title="Aca (module)">Aca</a></span></span>
     &raquo; 
    <span class="title">Joiner</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Aca::Joiner
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Aca::Joiner</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Orchestrator::Constants</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>modules/aca/joiner.rb</dd>
  </dl>
  
</div>

<div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="MeetingRoom.html" title="Aca::MeetingRoom (class)">MeetingRoom</a></span></p>
</div>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#join-instance_method" title="#join (instance method)">#<strong>join</strong>(*ids)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notify_join-instance_method" title="#notify_join (instance method)">#<strong>notify_join</strong>(initiator, rooms)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notify_unjoin-instance_method" title="#notify_unjoin (instance method)">#<strong>notify_unjoin</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_load-instance_method" title="#on_load (instance method)">#<strong>on_load</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_update-instance_method" title="#on_update (instance method)">#<strong>on_update</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#perform_action-instance_method" title="#perform_action (instance method)">#<strong>perform_action</strong>(mod:, func:, index: 1, args: [], skipMe: false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unjoin-instance_method" title="#unjoin (instance method)">#<strong>unjoin</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="join-instance_method">
  
    #<strong>join</strong>(*ids)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 102</span>

<span class='kw'>def</span> <span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_ids'>ids</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_joining?'>joining?</span>

    <span class='id identifier rubyid_start_joining'>start_joining</span>

    <span class='comment'># Ensure all id&#39;s are symbols
</span>    <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbrace'>}</span>

    <span class='comment'># Grab only valid IDs
</span>    <span class='id identifier rubyid_rmset'>rmset</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ids'>ids</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='ivar'>@rooms</span>
    <span class='id identifier rubyid_rmset'>rmset</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@system_id</span>  <span class='comment'># Add the current system to room joins list
</span>    <span class='id identifier rubyid_rooms'>rooms</span> <span class='op'>=</span> <span class='id identifier rubyid_rmset'>rmset</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joining </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rooms'>rooms</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

    <span class='comment'># Inform the remote systems
</span>    <span class='id identifier rubyid_promise'>promise</span> <span class='op'>=</span> <span class='id identifier rubyid_inform'>inform</span><span class='lparen'>(</span><span class='symbol'>:join</span><span class='comma'>,</span> <span class='id identifier rubyid_rooms'>rooms</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_to_inform'>to_inform</span><span class='op'>|</span>
        <span class='id identifier rubyid_rms'>rms</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_to_inform'>to_inform</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_room_list'>room_list</span><span class='op'>|</span>
            <span class='comment'># Finally returns results like [[result, success_bool],[result, success_bool]]
</span>            <span class='id identifier rubyid_rms'>rms</span> <span class='op'>+=</span> <span class='id identifier rubyid_room_list'>room_list</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

        <span class='comment'># Warning as the UI should try to prevent this happening
</span>        <span class='id identifier rubyid_rms'>rms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
            <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Notifying system </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> of unjoin due to new join</span><span class='tstring_end'>&quot;</span></span>
            <span class='ivar'>@systems</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='ivar'>@join_module_class</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_notify_unjoin'>notify_unjoin</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_finally'>finally</span> <span class='kw'>do</span>
        <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:is_joined</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_finish_joining'>finish_joining</span>
        <span class='id identifier rubyid_commit_join'>commit_join</span><span class='lparen'>(</span><span class='symbol'>:join</span><span class='comma'>,</span> <span class='ivar'>@system_id</span><span class='comma'>,</span> <span class='id identifier rubyid_rooms'>rooms</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notify_join-instance_method">
  
    #<strong>notify_join</strong>(initiator, rooms)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_join'>notify_join</span><span class='lparen'>(</span><span class='id identifier rubyid_initiator'>initiator</span><span class='comma'>,</span> <span class='id identifier rubyid_rooms'>rooms</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_joined_to'>joined_to</span> <span class='op'>=</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:joined</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:rooms</span><span class='rbracket'>]</span>

    <span class='comment'># Grab a list of rooms that need to be unjoined due to a new join
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_joined_to'>joined_to</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_remaining'>remaining</span> <span class='op'>=</span> <span class='id identifier rubyid_joined_to'>joined_to</span> <span class='op'>-</span> <span class='id identifier rubyid_rooms'>rooms</span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_remaining'>remaining</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:is_joined</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>

    <span class='comment'># Commit the newly joined rooms
</span>    <span class='id identifier rubyid_commit_join'>commit_join</span><span class='lparen'>(</span><span class='symbol'>:join</span><span class='comma'>,</span> <span class='id identifier rubyid_initiator'>initiator</span><span class='comma'>,</span> <span class='id identifier rubyid_rooms'>rooms</span><span class='comma'>,</span> <span class='id identifier rubyid_remaining'>remaining</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notify_unjoin-instance_method">
  
    #<strong>notify_unjoin</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 200</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_unjoin'>notify_unjoin</span>
    <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:is_joined</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_commit_join'>commit_join</span><span class='lparen'>(</span><span class='symbol'>:unjoin</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_load-instance_method">
  
    #<strong>on_load</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 58</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_load'>on_load</span>
    <span class='ivar'>@retry_load</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@loaded</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@room_list_built</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_system'>system</span><span class='period'>.</span><span class='id identifier rubyid_load_complete'>load_complete</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_retry_load'>retry_load</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_update-instance_method">
  
    #<strong>on_update</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 68</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_update'>on_update</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='op'>::</span><span class='const'>Orchestrator</span><span class='op'>::</span><span class='const'>Control</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_ready'>ready</span>
        <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Room join update called before system ready</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># Grab the list of rooms and room details
</span>    <span class='ivar'>@systems</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>       <span class='comment'># Provides system proxy lookup
</span>    <span class='ivar'>@system_id</span> <span class='op'>=</span> <span class='id identifier rubyid_system'>system</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>

    <span class='ivar'>@join_module_class</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_setting'>setting</span><span class='lparen'>(</span><span class='symbol'>:joiner_driver</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='symbol'>:Joiner</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

    <span class='comment'># System lookup occurs on a seperate thread returning a promise
</span>    <span class='comment'># Seems the database won&#39;t store an empty array and we don&#39;t want duplicates
</span>    <span class='id identifier rubyid_system_proxies'>system_proxies</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_rms'>rms</span> <span class='op'>=</span> <span class='id identifier rubyid_setting'>setting</span><span class='lparen'>(</span><span class='symbol'>:rooms</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_rms'>rms</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_rms'>rms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No room joining settings provided</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
        <span class='id identifier rubyid_rms'>rms</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_rms'>rms</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@system_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

    <span class='id identifier rubyid_rooms'>rooms</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_rms'>rms</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rooms'>rooms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_lookup'>lookup</span><span class='op'>|</span>
        <span class='id identifier rubyid_system_proxies'>system_proxies</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_systems'>systems</span><span class='lparen'>(</span><span class='id identifier rubyid_lookup'>lookup</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Room joining init success</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
    <span class='id identifier rubyid_build_room_list'>build_room_list</span><span class='lparen'>(</span><span class='id identifier rubyid_system_proxies'>system_proxies</span><span class='rparen'>)</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="perform_action-instance_method">
  
    #<strong>perform_action</strong>(mod:, func:, index: 1, args: [], skipMe: false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 161</span>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_action'>perform_action</span><span class='lparen'>(</span><span class='label'>mod:</span><span class='comma'>,</span> <span class='label'>func:</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>args:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>skipMe:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

    <span class='comment'># TODO:: Should warn people not to send arguments that might be modified
</span>    <span class='comment'># As multiple threads will be recieving these data structures
</span>    <span class='id identifier rubyid_rooms'>rooms</span> <span class='op'>=</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:joined</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:rooms</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span>
        <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Calling </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mod'>mod</span><span class='embexpr_end'>}</span><span class='tstring_content'>-&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_func'>func</span><span class='embexpr_end'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rooms'>rooms</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> (skipping </span><span class='embexpr_beg'>#{</span><span class='ivar'>@system_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_skipMe'>skipMe</span>
        <span class='id identifier rubyid_msg'>msg</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_rooms'>rooms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id_str'>id_str</span><span class='op'>|</span>
        <span class='comment'># Might have been pulled from the database
</span>        <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_id_str'>id_str</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_skipMe'>skipMe</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='ivar'>@system_id</span>
        <span class='id identifier rubyid_promises'>promises</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@systems</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_func'>func</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Allows you to perform an action after this has been processed on all systems
</span>    <span class='id identifier rubyid_thread'>thread</span><span class='period'>.</span><span class='id identifier rubyid_finally'>finally</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unjoin-instance_method">
  
    #<strong>unjoin</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'modules/aca/joiner.rb', line 139</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unjoin'>unjoin</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_joining?'>joining?</span>

    <span class='id identifier rubyid_start_joining'>start_joining</span>

    <span class='comment'># Grab only valid IDs
</span>    <span class='id identifier rubyid_rmset'>rmset</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:joined</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:rooms</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='ivar'>@rooms</span>
    <span class='id identifier rubyid_rmset'>rmset</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@system_id</span>
    <span class='id identifier rubyid_rooms'>rooms</span> <span class='op'>=</span> <span class='id identifier rubyid_rmset'>rmset</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unjoining </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rooms'>rooms</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

    <span class='comment'># Inform the remote systems
</span>    <span class='id identifier rubyid_promise'>promise</span> <span class='op'>=</span> <span class='id identifier rubyid_inform'>inform</span><span class='lparen'>(</span><span class='symbol'>:unjoin</span><span class='comma'>,</span> <span class='id identifier rubyid_rooms'>rooms</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_finally'>finally</span> <span class='kw'>do</span>
        <span class='kw'>self</span><span class='lbracket'>[</span><span class='symbol'>:is_joined</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_finish_joining'>finish_joining</span>
        <span class='id identifier rubyid_commit_join'>commit_join</span><span class='lparen'>(</span><span class='symbol'>:unjoin</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_promise'>promise</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Jun 28 04:36:31 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.4.6).
</div>

    </div>
  </body>
</html>